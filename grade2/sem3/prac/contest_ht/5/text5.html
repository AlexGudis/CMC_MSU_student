<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
<title>Problem statement</title>
</head>
<body>
<h3>Problem ht09-5: ht09-5</h3>
<p/>

<p>Реализуйте функции</p>

<pre><code>size_t uleb128_len(uint64_t value);
uint8_t *uleb128_encode(uint8_t *ptr, uint64_t value);

struct ReadContext
{
    uint8_t *buf;
    size_t size;
    size_t pos;
    uint64_t value_u64;
};
bool uleb128_decode(struct ReadContext *cntx);
</code></pre>

<p>Функция <code>uleb128_len</code> возвращает количество байт,
которые необходимы для кодирования значения <code>value</code>
в формате ULEB128.</p>

<p>Функция <code>uleb128_encode</code> кодирует переданное значение
<code>value</code> в ULEB128 и записывает результат по адресу
<code>ptr</code>. Возвращается новое значение указателя <code>ptr</code>,
то есть возвращаемое значение указывает на место, непосредственно
после конца закодированного числа. Предполагается, что память под
кодирование уже выделена, и функция сама не выделяет память.
Число должно кодироваться последовательностью байт минимальной длины,
то есть незначащие нули в старших битах числа не допускаются,
если это только не самый последний байт записи числа.</p>

<p>Функция <code>uleb128_decode</code> декодирует значение из
формата ULEB128 в хост-представление числа.
В случае ошибки декодирования возвращается результат <code>false</code>,
и поля структуры <code>cntx</code> не меняются.
В случае успешного декодирования возвращается результат <code>true</code>,
и поля структуры <code>cntx</code> соответственно изменяются.</p>

<p>Данные для декодирования хранятся в буфере с адресом начала
<code>cntx-&gt;buf</code> и размером <code>cntx-&gt;size</code>.
Декодирование должно начинаться со смещения <code>cntx-&gt;pos</code>
в этом буфере. При успешном декодировании результат записывается
в <code>cntx-&gt;value_u64</code>, а смещение
<code>cntx-&gt;pos</code> продвигается вперед на соответствующее
число байт. Обратите внимание, что при успешном декодировании
смещение не может превышать размер буфера.</p>

<p>При декодировании должны выявляться следующие ошибки:</p>
<ul>
  <li>число закодировано последовательностью байтов не минимальной длины;</li>
  <li>закодировано число, не представимое в типе <code>uint64_t</code>;</li>
  <li>запись числа выходит за границу буфера.</li>
</ul>

    
</body>
</html>

